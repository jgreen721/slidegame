<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        margin: 0;
        padding: 0;
        font-family: Georgia, "Times New Roman", Times, serif;
      }

      body {
        height: 100vh;
        width: 100vw;
        background: radial-gradient(gray, lightgray);
      }

      .app {
        /* padding: 1em; */
        display: flex;
        align-items: center;
        flex-direction: column;
        height: 100%;
        justify-content: space-evenly;
      }

      .game-container {
        width: 325px;
        height: 400px;
        border: 1px solid black;
        background: white;
        /* transform: translateY(150px); */
      }

      .slider {
        height: 16px;
        width: 75px;
        background: radial-gradient(red, rgb(75, 69, 69));
        position: relative;
        opacity: 0;
      }

      .show {
        opacity: 1;
      }

      .slide {
        animation: slide 4s infinite;
      }

      .italic {
        font-style: italic;
      }

      button {
        padding: 0.5em;
        border-radius: 100px;
        width: 200px;
        cursor: pointer;
        border: none;
        transition: 1s ease;
      }

      button:hover {
        background: rgb(209, 198, 198);
      }

      .flex {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      h4 {
        margin: 0px 15px;
      }

      @keyframes slide {
        0% {
          left: 0px;
        }
        50% {
          left: 250px;
        }
        100% {
          left: 0px;
        }
      }
    </style>
    <title>Vanilla.JS Slider Game</title>
  </head>
  <body>
    <div class="app">
      <h1><span class="italic">Slider</span> Game</h1>
      <h2>Score:<span class="score"></span></h2>
      <div class="flex">
        <h4>Miss:<span class="miss"></span></h4>
        <h4>Life:<span class="life"></span></h4>
        <h4>Bonus:<span class="bonus"></span></h4>
      </div>
      <div class="game-container"></div>
      <button>Start</button>
    </div>

    <script>
      var gameCard = document.querySelector(".game-container");
      var btn = document.querySelector("button");
      var scoreEl = document.querySelector(".score");
      var missEl = document.querySelector(".miss");
      var lifeEl = document.querySelector(".life");
      var bonusEl = document.querySelector(".bonus");
      var cardCounter = 24;
      var score = 0;
      var bonusCounter = 10;

      function init() {
        cardCounter = 24;
        bonusCounter = 10;
        lifeEl.innerHTML = "100%";
        score = 0;
        scoreEl.innerHTML = score;
        Array(25)
          .fill()
          .forEach(() => {
            let sliderDiv = document.createElement("div");
            sliderDiv.className = "slider";

            gameCard.append(sliderDiv);
          });
        var sliders = document.querySelectorAll(".slider");
        sliders[cardCounter].classList.add("show");
        sliders[cardCounter].classList.add("slide");
      }

      function startGame() {}

      //   init();

      btn.onclick = (e) => {
        if (e.target.textContent === "Start") {
          init();
          e.target.textContent = "Stop Brick";
          return;
        }

        stopBrick();
      };

      function stopBrick() {
        var sliders = document.querySelectorAll(".slider");
        console.log("stopbrick");
        let left = parseInt(
          window.getComputedStyle(sliders[cardCounter]).getPropertyValue("left")
        );
        sliders[cardCounter].classList.remove("slide");
        sliders[cardCounter].style.left = `${left}px`;

        if (cardCounter <= 23) {
          checkBrick(
            sliders[cardCounter],
            sliders[cardCounter + 1],
            cardCounter
          );
        }

        cardCounter--;
        sliders[cardCounter].classList.add("show");
        sliders[cardCounter].classList.add("slide");
        if (cardCounter === -1) {
          alert("WINNER!! :) \n Score: " + score);
          btn.textContent = "Start";
        }
      }

      function checkBrick(freshBrick, placedBrick, counter) {
        var points = 100;
        console.log(freshBrick, placedBrick, counter);

        let fresh_left = parseInt(
          window.getComputedStyle(freshBrick).getPropertyValue("left")
        );
        let placed_left = parseInt(
          window.getComputedStyle(placedBrick).getPropertyValue("left")
        );

        // console.log(
        //   "freshLeft: " + fresh_left + "px placedLeft: " + placed_left + "px"
        // );
        let diff = Math.abs(fresh_left - placed_left);
        points -= diff;
        score += points;
        scoreEl.innerHTML = score;
        console.log("difference", diff);
        missEl.innerHTML = diff + "px";

        //offset element

        fresh_left > placed_left
          ? (freshBrick.style.left = `${fresh_left - diff}px`)
          : (freshBrick.style.left = `${fresh_left + diff}px`);

        // current width
        let curWidth = parseInt(
          window.getComputedStyle(freshBrick).getPropertyValue("width")
        );

        console.log("CurWidth", curWidth);
        if (diff > curWidth) {
          return gameOver();
        }
        let newWidth = curWidth - diff;
        console.log("newWidth", newWidth);
        lifeEl.innerHTML = `${(newWidth / 75).toFixed(2)}%`;

        //change width
        for (let i = 0; i < counter; i++) {
          document.querySelectorAll(".slider")[i].style.width = `${newWidth}px`;
        }

        bonusCounter--;

        if (bonusCounter === 0) {
          for (let i = 0; i < counter; i++) {
            document.querySelectorAll(".slider")[i].style.width = `75px`;
          }
          bonusCounter = 9;
        }
        bonusEl.innerHTML = bonusCounter;
      }

      function gameOver() {
        alert("Game over!");
        gameCard.innerHTML = "";
        btn.textContent = "Start";
      }
    </script>
  </body>
</html>
